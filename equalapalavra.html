<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, user-scalable=no" />
  <title>Qual é a Palavra? - Versão Simplificada</title>
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    .hover-scale:hover {
      transform: scale(1.2);
      transition: transform 0.2s;
      cursor: pointer;
    }
    .active-turn {
      border: 4px solid #3b82f6; /* Tailwind blue-500 */
    }

    /* Animação final (mantida igual, 12x maior) */
    @keyframes growAndFade {
      0% {
        transform: scale(0.5);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      80% {
        transform: scale(1.2);
        opacity: 1;
      }
      100% {
        transform: scale(1.3);
        opacity: 0;
      }
    }
  </style>
</head>

<body class="w-screen min-h-screen bg-gradient-to-br from-gray-100 to-blue-100 p-2 md:p-4 overflow-x-hidden">
  <div id="app" class="max-w-[1920px] mx-auto relative">
    <!-- Canvas de Confetti -->
    <canvas
      id="confettiCanvas"
      class="pointer-events-none fixed top-0 left-0 w-full h-full z-50"
    ></canvas>

    <!-- ~~~~~~~~~~ MODAL REGRAS ~~~~~~~~~~ -->
    <div
      id="modalRegras"
      class="fixed inset-0 bg-black bg-opacity-50 items-center justify-center hidden z-40"
    >
      <div class="bg-white p-6 rounded-xl shadow-2xl max-w-lg mx-auto">
        <h2 class="text-2xl font-bold mb-4">Regras do Jogo</h2>
        <p class="mb-4 text-sm leading-relaxed">
          1) Você deve formar duplas de jogadores.<br>
          2) Em cada palavra, a dupla que iniciar tem chance de ganhar 2 pontos se acertar de primeira.<br>
          3) Se errar, as outras duplas (ou a mesma dupla em nova vez) ganham 1 ponto se acertarem.<br>
          4) Se pular ou o tempo acabar, passa para a próxima dupla ou próxima palavra.<br>
          5) Ao final, a dupla com mais pontos vence.<br>
        </p>
        <button
          id="btnFalarRegras"
          class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded font-semibold shadow-lg mb-4 
                 transition duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-300"
        >
          Falar Regras
        </button>
        <button
          id="btnFecharModal"
          class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded font-semibold shadow-lg 
                 transition duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-red-300"
        >
          Fechar
        </button>
      </div>
    </div>
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    <!-- ~~~~~~~~~~ TELA DE CONFIGURAÇÃO ~~~~~~~~~~ -->
    <div id="config-screen" class="bg-white/80 rounded-2xl shadow-2xl p-4 md:p-8 mb-4">
      <div class="bg-blue-200 p-4 rounded shadow-md text-center mb-6">
        <h1 class="text-4xl font-extrabold">QUAL É A PALAVRA?</h1>
      </div>

      <h2 class="text-2xl font-extrabold mb-6 text-center">Configuração Inicial</h2>

      <!-- Idioma + Regras -->
      <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-4">
        <div>
          <label class="block mb-2 font-semibold">Escolha o idioma:</label>
          <div class="flex gap-4 flex-wrap">
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="idiomaRadio" value="PT-BR" checked>
              <span class="text-2xl">🇧🇷</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="idiomaRadio" value="PT-PT">
              <span class="text-2xl">🇵🇹</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="idiomaRadio" value="EN-US">
              <span class="text-2xl">🇺🇸</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="idiomaRadio" value="ES">
              <span class="text-2xl">🇪🇸</span>
            </label>
          </div>
        </div>
        <button
          id="btnRegras"
          class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded font-bold shadow-lg
                 transition duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-purple-300"
        >
          Regras?
        </button>
      </div>

      <!-- Tempo (padrão 60s) -->
      <div class="mb-4">
        <label class="block mb-1 font-semibold">Tempo Máximo (segundos):</label>
        <select id="tempoMaximo" class="border border-gray-300 p-2 rounded w-32">
          <option value="30">30 s</option>
          <option value="60" selected>60 s</option>
          <option value="90">90 s</option>
          <option value="120">120 s</option>
        </select>
      </div>

      <!-- 
        REMOVIDO: Opção de quantidade de palavras.
        Agora sempre serão 100, definimos no JS.
      -->

      <!-- Jogadores (máx 10) -->
      <div class="mb-4">
        <label class="block mb-2 font-semibold">Jogadores (máx 10):</label>
        <div class="flex flex-wrap gap-2 mb-2">
          <input
            type="text"
            id="nomeJogador"
            class="border border-gray-300 p-2 rounded w-full md:w-1/2"
            placeholder="Nome do Jogador"
          >
          <input
            type="file"
            id="fotoJogador"
            accept="image/*"
            capture="user"
            class="border border-gray-300 p-2 rounded w-full md:w-1/2 bg-white"
          >
        </div>
        <div class="flex gap-2 mb-4">
          <button
            id="btnAbrirCamera"
            class="bg-blue-400 hover:bg-blue-500 text-white px-3 py-2 rounded font-semibold shadow"
          >
            Abrir Câmera
          </button>
          <button
            id="btnCapturarFoto"
            class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded font-semibold shadow hidden"
          >
            Capturar Foto
          </button>
        </div>
        <div class="relative">
          <video
            id="videoCamera"
            class="border border-gray-300 w-64 h-48 object-cover rounded hidden"
            autoplay
            muted
          ></video>
          <canvas
            id="canvasFoto"
            class="border border-gray-300 w-64 h-48 object-cover rounded hidden"
          ></canvas>
        </div>
        <div class="flex justify-end mb-2">
          <button
            id="btnAdicionarJogador"
            class="bg-blue-500 hover:bg-blue-600 text-white px-5 py-2 rounded font-bold shadow-lg
                   transition duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-300"
          >
            Adicionar
          </button>
        </div>
        <div
          id="listaJogadores"
          class="bg-blue-50 border border-blue-200 p-3 rounded h-56 overflow-y-auto"
        ></div>
      </div>

      <!-- Modo Duplas -->
      <div class="mb-4">
        <label class="block mb-2 font-semibold">Formação das Duplas:</label>
        <div class="flex gap-2">
          <button
            id="btnModoAleatorio"
            class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded font-semibold"
            data-modo="aleatorio"
          >
            Aleatório
          </button>
          <button
            id="btnModoSequencial"
            class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded font-semibold"
            data-modo="manual"
          >
            Sequencial
          </button>
        </div>
      </div>

      <button
        id="btnIniciar"
        class="bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded w-full font-bold text-lg shadow-lg
               transition duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-green-300
               hover:scale-105 active:scale-95"
      >
        Iniciar
      </button>
    </div>
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    <!-- ~~~~~~~~~~ TELA PRINCIPAL (RESPONSIVA) ~~~~~~~~~~ -->
    <div id="main-screen" class="hidden bg-white rounded-xl shadow-xl mb-4 p-2 md:p-4">
      <!-- Linha Superior: Botões + Timer + Pontuação -->
      <div class="flex flex-col md:flex-row items-center justify-between gap-2 mb-4">
        <!-- Esquerda: Encerrar, Trocar, Pular -->
        <div class="flex gap-2">
          <button
            id="btnEncerrar"
            class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded font-semibold shadow
                   transition focus:outline-none focus:ring-2 focus:ring-red-300 hover:scale-105"
          >
            Encerrar Partida
          </button>
          <button
            id="btnTrocar"
            class="bg-yellow-400 hover:bg-yellow-500 text-white px-3 py-2 rounded font-semibold shadow
                   transition focus:outline-none focus:ring-2 focus:ring-yellow-300 hover:scale-105"
          >
            Trocar
          </button>
          <button
            id="btnPular"
            class="bg-gray-400 hover:bg-gray-500 text-white px-3 py-2 rounded font-semibold shadow
                   transition focus:outline-none focus:ring-2 focus:ring-gray-300 hover:scale-105"
          >
            Pular
          </button>
        </div>

        <!-- Centro: Timer + (Play/Pause e Reset) -->
        <div class="flex flex-col items-center justify-center">
          <p class="text-xl font-bold">Tempo Restante</p>
          <p id="tempoRestante" class="text-5xl font-extrabold text-green-600">60</p>
          <div class="flex gap-2 mt-2">
            <button
              id="btnToggleTempo"
              class="rounded-full w-12 h-12 bg-green-500 hover:bg-green-600 text-white flex items-center justify-center shadow
                     focus:outline-none focus:ring-2 focus:ring-green-300 hover:scale-105"
              title="Iniciar/Pausar Tempo"
            >
              ▶️/⏸
            </button>
            <button
              id="btnResetTempo"
              class="rounded-full w-12 h-12 bg-yellow-500 hover:bg-yellow-600 text-white flex items-center justify-center shadow
                     focus:outline-none focus:ring-2 focus:ring-yellow-300 hover:scale-105"
              title="Resetar Tempo"
            >
              ♻️
            </button>
          </div>
        </div>

        <!-- Direita: Pontuação -->
        <div
          id="boxPontuacao"
          class="bg-blue-50 p-4 rounded-xl shadow-md text-sm w-full md:w-72"
        >
          <h2 class="text-lg font-bold mb-2 text-center">Pontuação</h2>
          <div id="scoreContainer" class="flex flex-col gap-3"></div>
        </div>
      </div>

      <!-- Linha de Baixo: Dica | Palavra Secreta | Adivinhador -->
      <div class="flex flex-col md:flex-row gap-4 mb-4">
        <!-- Dica -->
        <div
          id="boxDoador"
          class="w-full md:w-1/3 p-3 bg-blue-50 rounded-xl shadow active-turn flex flex-col gap-2"
        >
          <h2 class="text-xl font-bold">Dica</h2>
          <div class="flex items-center gap-2">
            <!-- AGORA 50% do tamanho anterior. 
                 Se era w-80/h-80, agora w-40/h-40
            -->
            <img
              id="doadorFoto"
              src=""
              alt="Foto do Doador"
              class="w-40 h-40 object-cover rounded-full hidden"  <!-- <-- -->
            >
            <p class="text-blue-700 font-bold text-lg" id="doador"></p>
          </div>

          <label class="block font-semibold">Dica:</label>
          <div class="flex gap-2">
            <input
              type="text"
              id="campoDica"
              class="flex-1 border border-gray-300 rounded px-2 py-1"
            >
            <button
              id="btnEnviarDica"
              class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded font-semibold shadow
                     focus:outline-none focus:ring-2 focus:ring-blue-300 transition"
            >
              OK
            </button>
          </div>
        </div>

        <!-- Palavra Secreta -->
        <div
          id="boxPalavra"
          class="w-full md:w-1/3 p-3 bg-blue-50 rounded-xl shadow flex flex-col items-center justify-center gap-2"
        >
          <h2 class="text-xl font-bold">Palavra Secreta</h2>
          <input type="checkbox" id="togglePalavra" class="hidden">
          <label
            for="togglePalavra"
            id="labelToggle"
            class="cursor-pointer bg-gray-300 p-2 rounded shadow flex items-center"
          >
            <span id="eyeIcon" class="text-6xl">🙈</span>
          </label>
          <span
            id="palavraSecreta"
            class="hidden bg-white px-2 py-1 rounded shadow flex items-center gap-2"
          >
            <span class="text-2xl font-extrabold uppercase text-red-600">Palavra:</span>
            <span id="conteudoPalavra" class="text-xl font-bold uppercase text-red-500"></span>
          </span>
        </div>

        <!-- Adivinhador -->
        <div
          id="boxAdiv"
          class="w-full md:w-1/3 p-3 bg-blue-50 rounded-xl shadow flex flex-col gap-2"
        >
          <h2 class="text-xl font-bold">Adivinhador</h2>
          <div class="flex items-center gap-2">
            <!-- 50% do tamanho anterior: de w-80/h-80 -> w-40/h-40 -->
            <img
              id="adivinhadorFoto"
              src=""
              alt="Foto do Adivinhador"
              class="w-40 h-40 object-cover rounded-full hidden"
            >
            <p class="text-green-700 font-bold text-lg" id="adivinhador"></p>
          </div>
          <label class="block font-semibold">Chute:</label>
          <div class="flex gap-2">
            <input
              type="text"
              id="campoChute"
              class="flex-1 border border-gray-300 rounded px-2 py-1"
            >
            <button
              id="btnEnviarChute"
              class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded font-semibold shadow
                     focus:outline-none focus:ring-2 focus:ring-green-300 transition"
            >
              OK
            </button>
          </div>
        </div>
      </div>

      <!-- Histórico em Linha (cards) -->
      <div class="bg-blue-50 rounded-xl shadow p-3">
        <h3 class="text-xl font-bold mb-2">Histórico</h3>
        <!-- Horizontal scroll, cada ação em um “card” pequeno -->
        <div
          id="historicoAcoes"
          class="flex flex-row gap-4 overflow-x-auto p-2 rounded bg-white"
          style="min-height:80px;"
        ></div>
      </div>
    </div>
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    <!-- ~~~~~~~~~~ TELA FINAL ~~~~~~~~~~ -->
    <div
      id="end-screen"
      class="hidden bg-white/80 rounded-2xl shadow-2xl p-6 text-center"
    >
      <h1 class="text-2xl font-bold mb-4">Partida Encerrada</h1>
      <p id="resultado" class="text-xl mb-2"></p>
      <div id="pontuacaoFinal" class="mb-4"></div>

      <!-- Box p/ mostrar vencedores + troféu (mantido no tamanho original) -->
      <div id="winnerBox" class="flex flex-col items-center justify-center mb-4 hidden">
        <img
          src="https://cdn-icons-png.flaticon.com/512/9408/9408134.png"
          alt="Troféu"
          class="w-24 h-24 mb-2"
        >
        <div id="winnerPhotos" class="flex gap-4"></div>
      </div>

      <div class="flex gap-4 justify-center">
        <button
          id="btnSair"
          class="bg-red-400 hover:bg-red-500 text-white px-4 py-2 rounded font-semibold shadow-lg
                 transition duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-red-300 
                 hover:scale-105"
        >
          Sair
        </button>
        <button
          id="btnCompartilhar"
          class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded font-semibold shadow-lg
                 transition duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-300 
                 hover:scale-105"
        >
          Compartilhar
        </button>
      </div>
    </div>
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
  </div>

  <script>
  (function(){
    /* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       VARIÁVEIS GLOBAIS
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
    let primeiraTentativa = true;
    let timerJaIniciado = false;
    let jogadores = [];
    let duplas = [];
    let scores = [];
    let palavrasRodada = [];
    let indicePalavra = 0;
    let duplaAtual = 0;
    let tempoMaximoValue = 60;
    let tempoRestante = 60;
    let timerInterval = null;
    let historico = [];
    let cameraStream = null;
    let tempFotoDataUrl = "";
    let modoDuplas = "aleatorio";

    /* 
      Agora, fixamos 100 palavras por partida (em vez de escolher).
      -> Ao iniciar jogo, usaremos: 
            palavrasRodada = lista.slice(0, 100);
    */
    const MAX_PALAVRAS = 100; // <--

    /* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       LISTAS DE PALAVRAS
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
    const bigPTBR = [
      "Amor","Gato","Casa","Pão","Livre","Anel","Mesa","Bolo","Faro","Onça","Alvo","Vela","Abacate",
      // ...complete suas 2000...
    ];
    const palavrasBanco = {
      "PT-PT": ["cão","arco-íris","vermelho","futebol","jantar"],
      "EN-US": ["dog","rainbow","red","soccer","dinner"],
      "ES":    ["perro","arcoiris","rojo","futbol","cena"]
    };

    /* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       CAPTURAS DO DOM
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
    const modalRegras = document.getElementById("modalRegras");
    const btnRegras = document.getElementById("btnRegras");
    const btnFecharModal = document.getElementById("btnFecharModal");
    const btnFalarRegras = document.getElementById("btnFalarRegras");

    const configScreen = document.getElementById("config-screen");
    const mainScreen = document.getElementById("main-screen");
    const endScreen = document.getElementById("end-screen");

    const inputTempoMaximo = document.getElementById("tempoMaximo");
    const inputNomeJogador = document.getElementById("nomeJogador");
    const inputFotoJogador = document.getElementById("fotoJogador");
    const listaJogadoresEl = document.getElementById("listaJogadores");

    const btnAbrirCamera = document.getElementById("btnAbrirCamera");
    const btnCapturarFoto = document.getElementById("btnCapturarFoto");
    const videoCamera = document.getElementById("videoCamera");
    const canvasFoto = document.getElementById("canvasFoto");

    const btnAdicionarJogador = document.getElementById("btnAdicionarJogador");
    const btnIniciar = document.getElementById("btnIniciar");
    const btnEncerrar = document.getElementById("btnEncerrar");
    const btnTrocar = document.getElementById("btnTrocar");
    const btnPular = document.getElementById("btnPular");

    const btnToggleTempo = document.getElementById("btnToggleTempo");
    const btnResetTempo = document.getElementById("btnResetTempo");

    const btnEnviarDica = document.getElementById("btnEnviarDica");
    const btnEnviarChute = document.getElementById("btnEnviarChute");

    const scoreContainer = document.getElementById("scoreContainer");
    const doadorEl = document.getElementById("doador");
    const doadorFoto = document.getElementById("doadorFoto");
    const adivinhadorEl = document.getElementById("adivinhador");
    const adivinhadorFoto = document.getElementById("adivinhadorFoto");
    const palavraSecretaEl = document.getElementById("palavraSecreta");
    const conteudoPalavraEl = document.getElementById("conteudoPalavra");
    const tempoRestanteEl = document.getElementById("tempoRestante");
    const campoDica = document.getElementById("campoDica");
    const campoChute = document.getElementById("campoChute");
    const historicoAcoes = document.getElementById("historicoAcoes");

    const endResultado = document.getElementById("resultado");
    const endPontuacaoFinal = document.getElementById("pontuacaoFinal");
    const winnerBox = document.getElementById("winnerBox");
    const winnerPhotos = document.getElementById("winnerPhotos");
    const btnSair = document.getElementById("btnSair");
    const btnCompartilhar = document.getElementById("btnCompartilhar");

    const togglePalavraCheckbox = document.getElementById("togglePalavra");
    const eyeIcon = document.getElementById("eyeIcon");

    /* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       CONFETTI SETUP
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
    const confettiCanvas = document.getElementById("confettiCanvas");
    const confettiCtx = confettiCanvas.getContext("2d");
    confettiCanvas.width = window.innerWidth;
    confettiCanvas.height = window.innerHeight;
    window.addEventListener("resize", () => {
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
    });
    function launchConfetti(duration=2000){
      const end = Date.now() + duration;
      (function frame(){
        confetti({
          particleCount: 5,
          angle: Math.random()*60+100,
          spread: 55,
          origin: { x: Math.random(), y: Math.random()*0.3 },
          useWorker: true
        });
        if(Date.now()<end) requestAnimationFrame(frame);
      })();
    }
    function celebrarAcerto(duplaIndex){
      // Mantido 12x maior (w-192/h-192) para animação final
      const overlay = document.createElement("div");
      overlay.className = "fixed inset-0 flex items-center justify-center z-50 pointer-events-none";

      const duoContainer = document.createElement("div");
      duoContainer.className = "flex items-center gap-8";

      const [p1, p2] = duplas[duplaIndex];
      [p1, p2].forEach( pl => {
        const imgEl = document.createElement("img");
        imgEl.src = pl.photo || "https://via.placeholder.com/64";
        imgEl.alt = "Foto";
        imgEl.className = "animate-zoomPhoto object-cover rounded-full";
        imgEl.style.width = "192px";  
        imgEl.style.height = "192px"; 
        imgEl.style.animation = "growAndFade 2s forwards";
        duoContainer.appendChild(imgEl);
      });

      overlay.appendChild(duoContainer);
      document.body.appendChild(overlay);

      setTimeout(()=>{
        document.body.removeChild(overlay);
      },2000);
    }

    /* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       REGRAS (MODAL)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
    btnRegras.addEventListener("click", ()=>{
      modalRegras.classList.remove("hidden");
      modalRegras.classList.add("flex");
    });
    btnFecharModal.addEventListener("click", ()=>{
      modalRegras.classList.add("hidden");
      modalRegras.classList.remove("flex");
    });
    btnFalarRegras.addEventListener("click", ()=>{
      const msg = new SpeechSynthesisUtterance();
      msg.text = "1) Formar duplas ... 2) Dupla que inicia pode ganhar 2 pontos ... 3) Se errar, valem 1 ponto ... etc.";
      msg.lang = "pt-BR";
      speechSynthesis.speak(msg);
    });

    /* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       MODO DUPLAS
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
    document.getElementById("btnModoAleatorio").addEventListener("click",(e)=>{
      modoDuplas = e.target.dataset.modo; // "aleatorio"
      e.target.classList.add("bg-blue-300");
      document.getElementById("btnModoSequencial").classList.remove("bg-blue-300");
    });
    document.getElementById("btnModoSequencial").addEventListener("click",(e)=>{
      modoDuplas = e.target.dataset.modo; // "manual"
      e.target.classList.add("bg-blue-300");
      document.getElementById("btnModoAleatorio").classList.remove("bg-blue-300");
    });

    /* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       INICIAR / ENCERRAR / SAIR
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
    btnIniciar.addEventListener("click", iniciarJogo);
    btnEncerrar.addEventListener("click", encerrarPartida);
    btnSair.addEventListener("click", sairParaConfig);

    function getSelectedIdioma(){
      const radio = document.querySelector('input[name="idiomaRadio"]:checked');
      return radio? radio.value : "PT-BR";
    }

    function iniciarJogo(){
      if(jogadores.length<4 || jogadores.length%2!==0){
        alert("É necessário ao menos 4 jogadores (número par).");
        return;
      }
      // Reset
      duplas=[];
      scores=[];
      palavrasRodada=[];
      indicePalavra=0;
      duplaAtual=0;
      primeiraTentativa=true;
      timerJaIniciado=false;
      pararTimer();

      // tempo
      tempoMaximoValue = parseInt(inputTempoMaximo.value)||60;
      tempoRestante=tempoMaximoValue;
      tempoRestanteEl.textContent=tempoRestante;
      tempoRestanteEl.classList.remove("text-red-600");
      tempoRestanteEl.classList.add("text-green-600");

      // formar duplas
      let arrCopia = [...jogadores];
      if(modoDuplas==="aleatorio") shuffleArray(arrCopia);
      for(let i=0; i<arrCopia.length; i+=2){
        duplas.push([ arrCopia[i], arrCopia[i+1] ]);
      }
      scores = new Array(duplas.length).fill(0);

      // pega palavras
      const idioma = getSelectedIdioma();
      let lista;
      if (idioma==="PT-BR"){
        lista = bigPTBR;
      } else {
        lista = palavrasBanco[idioma] || [];
      }
      shuffleArray(lista);

      /* 
         Agora fixamos: 100 palavras (MAX_PALAVRAS).
      */
      palavrasRodada = lista.slice(0, MAX_PALAVRAS);

      // historico e UI
      historico=[];
      atualizarHistoricoNaTela();

      togglePalavraCheckbox.checked=false;
      palavraSecretaEl.classList.add("hidden");
      eyeIcon.textContent="🙈";

      renderPontuacao();
      atualizarDuplaNaTela();
      exibirTelaPrincipal();
    }

    function encerrarPartida(){
      exibirTelaFinal();
      pararTimer();
      let maiorPontuacao = Math.max(...scores);
      let indicesMax = scores.map((v,i)=>(v===maiorPontuacao? i:-1)).filter(x=>x>=0);

      if(indicesMax.length>1){
        endResultado.textContent="Temos um Empate!";
      } else {
        const [p1,p2] = duplas[indicesMax[0]];
        endResultado.textContent="Dupla Vencedora: "+ p1.name+" & "+p2.name;
      }
      endPontuacaoFinal.innerHTML = "<h2 class='font-semibold text-lg'>Pontuação Final</h2>";
      duplas.forEach((dupla, idx)=>{
        const div = document.createElement("div");
        div.className="flex items-center gap-2 my-2";
        dupla.forEach((p)=>{
          if(p.photo){
            const img = document.createElement("img");
            img.src=p.photo;
            img.alt="Foto";
            img.className="w-8 h-8 object-cover rounded-full";
            div.appendChild(img);
          }
        });
        const sp = document.createElement("span");
        sp.textContent = dupla[0].name.toUpperCase()+" & "+dupla[1].name.toUpperCase()+": "+scores[idx]+" pts";
        div.appendChild(sp);
        endPontuacaoFinal.appendChild(div);
      });

      // Exibir fotos vencedores + troféu se houver
      winnerBox.classList.add("hidden");
      winnerPhotos.innerHTML="";
      indicesMax.forEach((mx)=>{
        const [p1,p2] = duplas[mx];
        [p1,p2].forEach((pl)=>{
          const img = document.createElement("img");
          img.src=pl.photo||"https://via.placeholder.com/64";
          img.alt=pl.name;
          img.className="w-16 h-16 object-cover rounded-full border-2 border-yellow-500";
          winnerPhotos.appendChild(img);
        });
      });
      if(indicesMax.length>0){
        winnerBox.classList.remove("hidden");
        launchConfetti(4000);
      }
    }

    function sairParaConfig(){
      jogadores=[];
      duplas=[];
      scores=[];
      historico=[];
      palavrasRodada=[];
      indicePalavra=0;
      duplaAtual=0;
      inputNomeJogador.value="";
      inputFotoJogador.value="";
      renderJogadores();
      exibirTelaConfig();
    }

    /* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       TROCAR PALAVRA
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
    btnTrocar.addEventListener("click", trocarPalavra);
    function trocarPalavra(){
      registrarHistorico("TROCAR", "Palavra trocada", getAdivinhadorName());
      pararTimer();

      // Pega uma nova do bigPTBR (ou outra base)
      const randomIndex = Math.floor(Math.random()*bigPTBR.length);
      const nova = bigPTBR[randomIndex];
      palavrasRodada[indicePalavra] = nova;

      tempoRestante=tempoMaximoValue;
      tempoRestanteEl.textContent=tempoRestante;
      tempoRestanteEl.classList.remove("text-red-600");
      tempoRestanteEl.classList.add("text-green-600");

      conteudoPalavraEl.textContent=nova;
      togglePalavraCheckbox.checked=false;
      palavraSecretaEl.classList.add("hidden");
      eyeIcon.textContent="🙈";
    }

    /* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       PULAR PALAVRA
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
    btnPular.addEventListener("click", ()=>{
      registrarHistorico("PULOU","Palavra pulada", getAdivinhadorName());
      pararTimer();
      passarParaProximaPalavra();
    });

    /* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       TIMER / BOTÕES
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
    btnToggleTempo.addEventListener("click", ()=>{
      if(timerInterval){
        pararTimer();
      } else {
        iniciarTimer();
      }
    });
    btnResetTempo.addEventListener("click", ()=>{
      pararTimer();
      tempoRestante=tempoMaximoValue;
      tempoRestanteEl.textContent=tempoRestante;
      tempoRestanteEl.classList.remove("text-red-600");
      tempoRestanteEl.classList.add("text-green-600");
    });

    function iniciarTimer(){
      if(timerInterval) return;
      timerInterval = setInterval(()=>{
        tempoRestante--;
        tempoRestanteEl.textContent=tempoRestante;

        if(tempoRestante<=10){
          tempoRestanteEl.classList.remove("text-green-600");
          tempoRestanteEl.classList.add("text-red-600");
        } else {
          tempoRestanteEl.classList.remove("text-red-600");
          tempoRestanteEl.classList.add("text-green-600");
        }
        if(tempoRestante<=0){
          pararTimer();
          registrarHistorico("PULOU","Tempo esgotado.",getAdivinhadorName());
          passarParaProximaDuplaMesmaPalavra();
        }
      },1000);
    }
    function pararTimer(){
      if(timerInterval){
        clearInterval(timerInterval);
        timerInterval=null;
      }
    }

    /* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       DICA E CHUTE
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
    btnEnviarDica.addEventListener("click", ()=>{
      const dica=campoDica.value.trim();
      if(!dica) return;
      registrarHistorico("DICA", dica, getDoadorName());
      campoDica.value="";
      document.getElementById("boxDoador").classList.remove("active-turn");
      document.getElementById("boxAdiv").classList.add("active-turn");

      if(!timerJaIniciado){
        iniciarTimer();
        timerJaIniciado=true;
      }
    });
    btnEnviarChute.addEventListener("click", ()=>{
      const chute=campoChute.value.trim();
      if(!chute) return;
      const palavraAtual= palavrasRodada[indicePalavra];
      if(!palavraAtual) return;

      if(chute.toLowerCase()=== palavraAtual.toLowerCase()){
        // ACERTO
        const adiv = getAdivinhadorName();
        const pts = primeiraTentativa? 2:1;
        registrarHistorico("ACERTO", chute, adiv, pts);
        scores[duplaAtual]+=pts;
        renderPontuacao();
        launchConfetti();
        celebrarAcerto(duplaAtual);

        passarParaProximaPalavra();
        document.getElementById("boxAdiv").classList.remove("active-turn");
        document.getElementById("boxDoador").classList.add("active-turn");
      } else {
        // ERRO
        registrarHistorico("ERRO", chute, getAdivinhadorName());
        if(primeiraTentativa) primeiraTentativa=false;
        passarParaProximaDuplaMesmaPalavra();
      }
      campoChute.value="";
    });

    function passarParaProximaPalavra(){
      indicePalavra++;
      if(indicePalavra>=palavrasRodada.length){
        encerrarPartida();
        return;
      }
      duplaAtual=(duplaAtual+1)%duplas.length;
      tempoRestante=tempoMaximoValue;
      tempoRestanteEl.textContent=tempoRestante;
      tempoRestanteEl.classList.remove("text-red-600");
      tempoRestanteEl.classList.add("text-green-600");
      primeiraTentativa=true;

      togglePalavraCheckbox.checked=false;
      palavraSecretaEl.classList.add("hidden");
      eyeIcon.textContent="🙈";
      atualizarDuplaNaTela();
    }
    function passarParaProximaDuplaMesmaPalavra(){
      duplaAtual=(duplaAtual+1)%duplas.length;
      tempoRestante=tempoMaximoValue;
      tempoRestanteEl.textContent=tempoRestante;
      tempoRestanteEl.classList.remove("text-red-600");
      tempoRestanteEl.classList.add("text-green-600");

      togglePalavraCheckbox.checked=false;
      palavraSecretaEl.classList.add("hidden");
      eyeIcon.textContent="🙈";
      atualizarDuplaNaTela();
    }

    /* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       EXIBIR / ESCONDER TELAS
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
    function exibirTelaConfig(){
      configScreen.classList.remove("hidden");
      mainScreen.classList.add("hidden");
      endScreen.classList.add("hidden");
    }
    function exibirTelaPrincipal(){
      configScreen.classList.add("hidden");
      mainScreen.classList.remove("hidden");
      endScreen.classList.add("hidden");
    }
    function exibirTelaFinal(){
      configScreen.classList.add("hidden");
      mainScreen.classList.add("hidden");
      endScreen.classList.remove("hidden");
    }

    /* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       RENDER DE PONTUAÇÃO, DUPLAS, ETC.
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
    function atualizarDuplaNaTela(){
      const doadorPlayer= duplas[duplaAtual][0];
      const adivPlayer= duplas[duplaAtual][1];
      doadorEl.textContent=doadorPlayer.name.toUpperCase();
      adivinhadorEl.textContent=adivPlayer.name.toUpperCase();
      conteudoPalavraEl.textContent=palavrasRodada[indicePalavra]||"";

      if(doadorPlayer.photo){
        doadorFoto.src=doadorPlayer.photo;
        doadorFoto.classList.remove("hidden");
      } else {
        doadorFoto.classList.add("hidden");
      }
      if(adivPlayer.photo){
        adivinhadorFoto.src=adivPlayer.photo;
        adivinhadorFoto.classList.remove("hidden");
      } else {
        adivinhadorFoto.classList.add("hidden");
      }

      document.getElementById("boxDoador").classList.remove("active-turn");
      document.getElementById("boxAdiv").classList.remove("active-turn");
      document.getElementById("boxDoador").classList.add("active-turn");
    }

    function renderPontuacao(){
      scoreContainer.innerHTML="";
      duplas.forEach((dupla,idx)=>{
        const row=document.createElement("div");
        row.className="flex items-center gap-2 bg-white rounded p-2 shadow";

        // Se era w-24/h-24, agora 50% => w-12/h-12
        dupla.forEach((p)=>{
          if(p.photo){
            const img=document.createElement("img");
            img.src=p.photo;
            img.alt="Foto";
            img.className="w-12 h-12 object-cover rounded-full";  // <-- 50%
            row.appendChild(img);
          }
        });
        const nomes=document.createElement("span");
        nomes.className="font-bold text-sm ml-2";
        nomes.textContent=dupla[0].name.toUpperCase()+" & "+dupla[1].name.toUpperCase();
        row.appendChild(nomes);

        const pts=document.createElement("span");
        pts.className="text-blue-700 font-extrabold text-lg ml-auto";
        pts.textContent=`${scores[idx]} pts`;
        row.appendChild(pts);

        scoreContainer.appendChild(row);
      });
    }

    // ~~~~~~~~~~~~ HISTÓRICO COM CORES DIFERENTES
    function registrarHistorico(acao, texto, jogador, pontos){
      const currentWord=palavrasRodada[indicePalavra]||"";
      historico.push({acao, texto, jogador, points:pontos, palavra:currentWord});
      atualizarHistoricoNaTela();
    }
    function atualizarHistoricoNaTela(){
      historicoAcoes.innerHTML="";
      historico.forEach((h)=>{
        let mensagem="";
        let icone="";
        let bgClass="bg-gray-100"; // default

        // ~~~~~ Distinção de cor no histórico ~~~~~
        // Exemplo: DICA = cor azul, Adivinhador(ERRO/ACERTO) = cor verde/vermelha, etc.
        if(h.acao==="DICA"){
          icone="💡";
          mensagem=`${icone} ${h.jogador}: "${h.texto}"`;
          bgClass="bg-blue-100"; // <-- dica em azul clarinho
        } 
        else if(h.acao==="ERRO"){
          icone="❌";
          mensagem=`${icone} ${h.jogador}: "${h.texto}"`;
          bgClass="bg-red-100"; // <-- erro em vermelho clarinho
        }
        else if(h.acao==="ACERTO"){
          icone="✅";
          mensagem=`${icone} ${h.jogador} +${h.points||0} pts`;
          bgClass="bg-green-100"; // <-- acerto em verde clarinho
        }
        else if(h.acao==="PULOU"){
          icone="⏭️";
          mensagem=`${icone} ${h.jogador}: ${h.texto}`;
          bgClass="bg-yellow-100"; // <-- pular em amarelo clarinho
        }
        else if(h.acao==="TROCAR"){
          icone="🔀";
          mensagem=`${icone} ${h.jogador}: ${h.texto}`;
          bgClass="bg-purple-100"; // <-- trocar em roxo clarinho
        }

        const secretIcon=document.createElement("span");
        secretIcon.textContent="👁️";
        secretIcon.className="ml-2 text-blue-700 hover-scale";
        secretIcon.title="Ver palavra secreta";
        secretIcon.addEventListener("click", ()=>{
          alert(`A palavra secreta era: ${h.palavra}`);
        });

        // Card do histórico
        const card=document.createElement("div");
        card.className=`${bgClass} border border-gray-300 rounded p-2 min-w-[120px] text-sm flex items-center`;
        card.textContent=mensagem;
        card.appendChild(secretIcon);

        historicoAcoes.appendChild(card);
      });
      historicoAcoes.scrollLeft=historicoAcoes.scrollWidth; // rola pro fim
    }

    function getDoadorName(){
      return duplas[duplaAtual][0].name.toUpperCase();
    }
    function getAdivinhadorName(){
      return duplas[duplaAtual][1].name.toUpperCase();
    }

    /* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       PALAVRA SECRETA (OLHINHO)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
    togglePalavraCheckbox.addEventListener("change", (e)=>{
      if(e.target.checked){
        palavraSecretaEl.classList.remove("hidden");
        eyeIcon.textContent="👁️";
      } else {
        palavraSecretaEl.classList.add("hidden");
        eyeIcon.textContent="🙈";
      }
    });

    /* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       CÂMERA
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
    btnAbrirCamera.addEventListener("click", async()=>{
      try {
        cameraStream = await navigator.mediaDevices.getUserMedia({ video:true });
        videoCamera.srcObject=cameraStream;
        videoCamera.classList.remove("hidden");
        btnCapturarFoto.classList.remove("hidden");
        canvasFoto.classList.add("hidden");
      }catch(e){
        alert("Não foi possível acessar a câmera: "+e);
      }
    });
    btnCapturarFoto.addEventListener("click", ()=>{
      if(!cameraStream) return;
      canvasFoto.classList.remove("hidden");
      canvasFoto.width=videoCamera.videoWidth;
      canvasFoto.height=videoCamera.videoHeight;
      const ctx=canvasFoto.getContext("2d");
      ctx.drawImage(videoCamera,0,0,canvasFoto.width,canvasFoto.height);
      let dataUrl=canvasFoto.toDataURL("image/png");
      videoCamera.classList.add("hidden");
      btnCapturarFoto.classList.add("hidden");
      cameraStream.getTracks().forEach(t=>t.stop());
      cameraStream=null;
      tempFotoDataUrl=dataUrl;
    });

    /* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       ADICIONAR JOGADOR
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
    btnAdicionarJogador.addEventListener("click", adicionarJogador);
    function adicionarJogador(){
      if(jogadores.length>=10){
        alert("Máximo de 10 jogadores atingido!");
        return;
      }
      let nome=inputNomeJogador.value.trim()||`Convidado #${jogadores.length+1}`;
      let colorClass=colorPalette[jogadores.length%colorPalette.length];
      let foto="";
      const file=inputFotoJogador.files[0];

      if(tempFotoDataUrl){
        foto=tempFotoDataUrl;
        tempFotoDataUrl="";
      } else if(file){
        const reader=new FileReader();
        reader.onload=(ev)=>{
          foto=ev.target.result;
          pushJogador(nome,colorClass,foto);
        };
        reader.readAsDataURL(file);
        return;
      }
      pushJogador(nome,colorClass,foto);
    }
    const colorPalette=[
      "bg-red-200 text-red-800",
      "bg-green-200 text-green-800",
      "bg-yellow-200 text-yellow-800",
      "bg-purple-200 text-purple-800",
      "bg-pink-200 text-pink-800",
      "bg-orange-200 text-orange-800",
      "bg-blue-200 text-blue-800",
      "bg-teal-200 text-teal-800"
    ];
    function pushJogador(name, color, photo){
      jogadores.push({name, color, photo});
      inputNomeJogador.value="";
      inputFotoJogador.value="";
      renderJogadores();
    }
    function removerJogador(idx){
      jogadores.splice(idx,1);
      renderJogadores();
    }
    function renderJogadores(){
      listaJogadoresEl.innerHTML="";
      jogadores.forEach((pl, i)=>{
        const div=document.createElement("div");
        div.className=`${pl.color} p-2 uppercase rounded mb-1 shadow-sm font-bold flex items-center justify-between`;

        const left=document.createElement("div");
        left.className="flex items-center gap-2";
        if(pl.photo){
          const imgEl=document.createElement("img");
          imgEl.src=pl.photo;
          imgEl.alt="Foto";
          imgEl.className="w-8 h-8 object-cover rounded-full";
          left.appendChild(imgEl);
        }
        const sp=document.createElement("span");
        sp.textContent=pl.name;
        left.appendChild(sp);

        div.appendChild(left);

        const btnRem=document.createElement("button");
        btnRem.textContent="X";
        btnRem.className="bg-red-400 hover:bg-red-500 text-white px-2 py-1 rounded font-bold";
        btnRem.addEventListener("click",()=>removerJogador(i));
        div.appendChild(btnRem);

        listaJogadoresEl.appendChild(div);
      });
    }

    /* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       COMPARTILHAR
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
    btnCompartilhar.addEventListener("click",()=>{
      const mensagem=`Fui campeão no jogo "Qual é a Palavra?"! Confira: https://exemplo.com/foto-dos-vencedores.jpg`;
      const linkWhats=`https://wa.me/?text=${encodeURIComponent(mensagem)}`;
      window.open(linkWhats,"_blank");
    });

    /* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       SHUFFLE
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
    function shuffleArray(arr){
      for(let i=arr.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
      }
      return arr;
    }

    /* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       INICIA NA TELA CONFIG
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
    exibirTelaConfig();
  })();
  </script>
</body>
</html>
